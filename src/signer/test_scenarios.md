# Test Scenarios for `nostr::signer`

## NIP-46: Remote Signing

### 1. Connection Handshake Initiated by the Remote Signer

    GIVEN a remote signer connected to a relay
    AND a client
    WHEN the remote signer provides the user a connection string of the form `bunker://<remote-signer-pubkey>?relay=<relay-url>`
    AND the user provides that connection string to the Nostr client
    THEN the client connects to the specified relay
    AND the client publishes a kind 24133 event to the relay
    AND the event has a `p` tag whose value is the remote signer's pubkey
    AND the event's `content` field is a NIP-04 encrypted JSON object containing the fields: `id`, `method`, and `params`
    AND the value of the `id` field is a unique string
    AND the value of the `method` field is `"connect"`
    AND the value of the `params` field is a JSON array containing the remote signer's pubkey in the first position
    AND the client establishes a subscription to the relay for kind 24133 events with a `p` tag containing the remote signer's pubkey and a `since` value equal to the time at which the client sent the event

### 2. Connection Handshake Completed by the Remote Signer

    GIVEN a remote signer connected to a relay
    AND a client connected to the same relay
    AND the client has published a kind 24133 event whose `content` field contains a `"connect"` method call
    AND the client has created a subscription to the relay for kind 24133 events with a `p` tag containing the remote signer's pubkey and a `since` value equal to the time at which the client sent the `"connect"` method call event
    WHEN the remote signer sends a kind 24133 event that matches the client's filter
    THEN the client shall record the event's `pubkey` value as the remote signer's pubkey
    AND the client shall decrypt the event's `content` field using NIP-04
    AND the client shall verify that the decrypted content is a JSON object containting the field `result` whose value is `"ack"`

### 3. Connection Handshake Initiated by the Client

    GIVEN a client connected to a relay
    AND a remote signer
    WHEN the client provides the user a connection string of the form `nostrconnect://<client-pubkey>?relay=<relay-url>&secret=<secret>`
    AND the user provides that connection string to the remote signer
    THEN the client creates a subscription to the specified relay for kind 24133 events with a `p` tag containing the client's pubkey and a `since` value equal to the time at which the client generated the connection string

### 4. Client-Initiated Connection Handshake Completed by the Remote Signer

    GIVEN a client connected to a relay
    AND a remote signer that has received a `nostrconnect://` connection string generated by the client
    AND a client subscription to the relay for kind 24133 events with a `p` tag containing the client's pubkey and a `since` value equal to the time at which the client generated the connection string
    WHEN the client receives a matching event from the relay
    THEN the client shall record the event's `pubkey` value as the remote signer's pubkey
    AND the client shall decrypt the event's `content` field using NIP-04
    AND the client shall verify that the decrypted content is a JSON object containting the field `result` whose value is equal to the `secret` param in the client-generated connection string
